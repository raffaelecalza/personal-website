<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="monoxide.js is a client for Carbon, a data injest tool which is a part of the Graphite project"><title>~/.../monoxide.js</title><link rel=icon href=/img/favicon.ico><link rel=stylesheet href=https://unpkg.com/terminal.css@0.7.2/dist/terminal.min.css integrity=sha384-wvN1Gjw/z/K/J9g4nsJGXEzA2AOKBTCnlsdubmWbXUzezZKPPObPGbZ2cMvjvEH5 crossorigin=anonymous><link rel=stylesheet type=text/css href=/css/code.min.css><link rel=stylesheet type=text/css href=/css/style.min.css></head><body><div id=content><div class=container><h5 class=back-link><a href=/projects/>~/projects</a></h5><h2 class="terminal-prompt terminal-prompt-spaced">cat readme.md</h2><ul class=small><li><strong>Link:</strong> <a href=https://github.com/raffaelecalza/monoxide.js target=_blank>https://github.com/raffaelecalza/monoxide.js</a></li><li><strong>Reading time:</strong> 4 minutes</li><li><strong>open source ❤️</strong></li></ul><hr><div class=single-content><h1>monoxide.js</h1><p><a href=https://standardjs.com><img src="https://img.shields.io/badge/code_style-standard-brightgreen.svg?style=flat-square" alt="JavaScript Style Guide"></a>
<img src="https://img.shields.io/npm/v/monoxide.js?label=npm&style=flat-square" alt="npm version">
<img src="https://img.shields.io/github/workflow/status/raffaelecalza/monoxide.js/CI?style=flat-square" alt="Github build status">
<a href=https://github.com/raffaelecalza/monoxide.js/blob/main/LICENSE><img src="https://img.shields.io/github/license/raffaelecalza/monoxide.js?label=license&style=flat-square" alt="License MIT"></a></p><p>monoxide.js is a Node.js client for Carbon that is a component of Graphite, and is responsible for receiving metrics over the network and writing them down to disk using a storage backend. This project is a fork of <a href=https://github.com/mixer/oxide>Oxide</a> but currently supports only Carbon and not StatsD as Oxide does (I&rsquo;m planning to add the support for StatsD in the next releases).</p><ul><li><a href=#installation>Installation</a></li><li><a href=#examples>Examples</a></li><li><a href=#usage>Usage</a><ul><li><a href=#configuration>Configuration</a></li><li><a href=#protocols>Protocols</a><ul><li><a href=#pickle-protocol>Pickle Protocol</a></li><li><a href=#plaintext-protocol>Plaintext Protocol</a></li><li><a href=#create-your-custom-protocol>Create your custom protocol</a></li></ul></li><li><a href=#carbon-client>Carbon client</a></li></ul></li><li><a href=#test>Test</a></li><li><a href=#contribution>Contribution</a></li><li><a href=#credits>Credits</a></li></ul><h2 id=installation>Installation</h2><p>To install this library, open a terminal and type:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm i --save monoxide.js
</span></span></code></pre></div><p>Then, import the library in your project:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Monoxide</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;monoxide.js&#39;</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=examples>Examples</h2><p>Inside the folder <code>/examples</code> you can see an example of sending metrics to Carbon using monoxide.js.</p><h2 id=usage>Usage</h2><p>To start sending metrics to Carbon you need to create 3 objects:</p><ol><li>the config object that stores the information about the server (Carbon)</li><li>the protocol object that formats the metrics before sending them to Carbon</li><li>the client that stores the metrics and periodically sends them to Carbon</li></ol><h3 id=configuration>Configuration</h3><p>After you installed and imported the library correctly, the first thing you need to create is a <code>Config</code> object. This class is responsible to store the data that will be used to connect to Carbon.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>config</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Monoxide</span><span class=p>.</span><span class=nx>Config</span><span class=p>(</span><span class=s1>&#39;127.0.0.1&#39;</span><span class=p>,</span> <span class=mi>1234</span><span class=p>,</span> <span class=mi>10000</span><span class=p>,</span> <span class=s1>&#39;your.global.prefix&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>The <code>config</code> object has 4 properties:</p><ul><li><em>host</em>: the ip address of the host where Carbon is currently running (<code>127.0.0.1</code>)</li><li><em>port</em>: the port where Carbon is currently listening (<code>1234</code>)</li><li><em>interval</em>: the interval in ms each time the metrics are sent to the server (<code>10000</code>)</li><li><em>prefix</em>: the prefix that will be appended to every metric&rsquo;s path before sending the metric to Carbon (<code>your.global.prefix</code>)</li></ul><p>The prefix is optional and can be omitted in the last parameter of the constructor if you don&rsquo;t want to prefix anything in the metric&rsquo;s path.</p><p>Also, if you don&rsquo;t pass anything to the constructor the config object will use the following parameters to connect to Carbon:</p><ul><li>host: <code>127.0.0.1</code></li><li>port: <code>2003</code></li><li>interval: <code>5000</code></li><li>prefix: <code>&lt;nothing></code></li></ul><h3 id=protocols>Protocols</h3><p>After you have created the config object, you have to create the protocol object. This object will be the responsible of formatting the metrics before sending them to the server.</p><p>You can choose between 2 different types of protocols:</p><ul><li><strong>pickle protocol</strong> [<a href=https://graphite.readthedocs.io/en/latest/feeding-carbon.html#the-pickle-protocol>More</a>]</li><li><strong>plaintext protocol</strong> [<a href=https://graphite.readthedocs.io/en/latest/feeding-carbon.html#the-plaintext-protocol>More</a>]</li></ul><h4 id=pickle-protocol>Pickle Protocol</h4><p>You can create an instance of the pickle protocol like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>protocol</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Monoxide</span><span class=p>.</span><span class=nx>Protocols</span><span class=p>.</span><span class=nx>PickleProtocol</span><span class=p>()</span>
</span></span></code></pre></div><h4 id=plaintext-protocol>Plaintext Protocol</h4><p>You can create an instance of the plaintext protocol like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>protocol</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Monoxide</span><span class=p>.</span><span class=nx>Protocols</span><span class=p>.</span><span class=nx>PlaintextProtocol</span><span class=p>()</span>
</span></span></code></pre></div><h4 id=create-your-custom-protocol>Create your custom protocol</h4><p>If you want, you can create your custom protocol. Just override the <code>AbstractProtocol</code> class or create an instance of this class. If you want to know more, you can take a look at the <code>AbstractProtocol</code> class&rsquo;s code and also at the derived classes <code>PlaintextProtocol</code> and <code>PickleProtocol</code>.</p><h3 id=carbon-client>Carbon client</h3><p>The client is the core component of the library. It&rsquo;s responsible of record, store and send metrics to the Carbon service. First, create the client:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>client</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Monoxide</span><span class=p>.</span><span class=nx>Clients</span><span class=p>.</span><span class=nx>CarbonClient</span><span class=p>(</span><span class=nx>config</span><span class=p>,</span> <span class=nx>protocol</span><span class=p>)</span>
</span></span></code></pre></div><p>Then, you need to start the process that sends the metrics periodically and opens a socket connection to Carbon:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>client</span><span class=p>.</span><span class=nx>start</span><span class=p>()</span>
</span></span></code></pre></div><p>The client emits 2 events:</p><ul><li><code>error</code>: everytime there is an error (for example, if there was an error sending the metrics)</li><li><code>metrics-sent</code>: everytime the metrics are correctly sent to Carbon</li></ul><p>You should at least subscribe to the <code>error</code> event so you can process the errors:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>client</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// process the error
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;metrics-sent&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// do some stuff
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span></code></pre></div><p>Now, you can record metrics that will be sent periodically to Carbon (using the interval you specified in the config object):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>client</span><span class=p>.</span><span class=nx>record</span><span class=p>(</span><span class=s1>&#39;example.metric.1&#39;</span><span class=p>,</span> <span class=mi>123</span><span class=p>,</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>())</span>
</span></span></code></pre></div><p>The metric will be enqueued and sent the next time the process that sends metrics will be executed. If you have specified the prefix, the record method will add the prefix in front of the metric path.</p><p>Also, If you don&rsquo;t provide the date object, the metric will be stored with the timestamp of its creation.</p><p>If you need, you can stop the sending process and close the connection to the server (you can restart the process using the <code>.start()</code> method):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>client</span><span class=p>.</span><span class=nx>stop</span><span class=p>()</span>
</span></span></code></pre></div><h2 id=test>Test</h2><p>If you want to test the code, clone the repo locally on your computer, install the project dependencies and then run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>npm <span class=nb>test</span>
</span></span></code></pre></div><h2 id=contribution>Contribution</h2><p>If you find a bug or just want to contribute to the project, you can open an <a href=https://github.com/raffaelecalza/monoxide.js/issues/new>issue</a> or fork the project and then open a pull request on branch <code>dev</code>.</p><h2 id=credits>Credits</h2><p>As I said above, this project is a fork of <a href=https://github.com/mixer/oxide>Oxide</a>. I decided to rewrite this library because on Github the project has been archived and on npm the last version doesn&rsquo;t reflect the code on Github.</p></div></div></div><footer class=container><hr><p class="small center">&copy; 2022 - <a href=https://github.com/raffaelecalza/personal-website target=_blank>v1.0.1</a> | Built with ❤️<span id=powered-by> - Powered by <a href=https://terminalcss.xyz/>Terminal.css</a></span> | <a href=#>[t]op</a></p></footer><script src=https://unpkg.com/micromodal/dist/micromodal.min.js integrity=sha384-ulTDlPHAncBA5mUh2PEcLGS5j766jh1CIhIAc2L3Ul5nO0onkHr/DQY91Mw3MRjx crossorigin=anonymous></script>
<script src=/js/others.min.js></script></body></html>